{{ define "main" }}
<article class="min-h-screen bg-base-100 pb-24 pt-8 md:pt-16 transition-colors duration-500">
  
  {{ $imageLink := "" }}
  {{ $imageObj := "" }} 
  {{ with .Params.image }}
    {{/* 1. Page Resource */}}
    {{ $res := $.Resources.GetMatch . }}
    {{ if $res }}
      {{ $imageObj = $res }}
      {{ $imageLink = $res.RelPermalink }}
    {{ else }}
      {{/* 2. Global Resource */}}
      {{ $global := resources.Get . }}
      {{ if $global }}
        {{ $imageObj = $global }}
        {{ $imageLink = $global.RelPermalink }}
      {{ else }}
        {{/* 3. Static/External */}}
        {{ $imageLink = . }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ $avatar := "/images/default-avatar.png" }} 
  {{ $avatarGlobal := resources.Get "images/default-avatar.png" }}
  {{ if $avatarGlobal }}
    {{ $avatar = $avatarGlobal.RelPermalink }}
  {{ end }}
  {{ $authorResource := .Resources.GetMatch "author.*" }}
  {{ if $authorResource }}
    {{ $avatar = $authorResource.RelPermalink }}
  {{ end }}

  <header class="mx-auto max-w-4xl px-6 text-center mb-10">
    
    <div class="mb-8 flex justify-center">
        <a href="/posts/" class="inline-flex items-center text-sm font-medium text-base-content/60 hover:text-primary transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Voltar para o Blog
        </a>
    </div>

    {{ with .Params.categories }}
    <div class="mb-6 flex justify-center">
      {{ range first 1 . }}
      <a href="/categories/{{ . | urlize }}" 
         class="px-4 py-1.5 rounded-full bg-primary/10 text-primary text-xs font-bold uppercase tracking-widest hover:bg-primary hover:text-primary-content transition-colors">
        {{ . }}
      </a>
      {{ end }}
    </div>
    {{ end }}

    <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-base-content leading-tight mb-6">
      {{ .Title }}
    </h1>

    {{ with .Params.description }}
    <p class="text-xl text-base-content/70 max-w-2xl mx-auto mb-8 leading-relaxed">
      {{ . }}
    </p>
    {{ end }}

    <div class="flex flex-wrap items-center justify-center gap-6 text-sm text-base-content/80">
      <div class="flex items-center gap-3">
        <div class="h-12 w-12 rounded-full ring-2 ring-base-200 overflow-hidden">
          <img src="{{ $avatar }}" alt="Avatar" class="w-full h-full object-cover">
        </div>
        <div class="text-left leading-tight">
          <span class="block font-bold text-base-content text-base">
            {{ .Params.author | default .Site.Params.author | default "Evandro Santos" }}
          </span>
          <span class="text-xs text-base-content/60">Autor</span>
        </div>
      </div>
      <span class="hidden sm:block text-base-content/20 text-2xl">•</span>
      <div class="flex items-center gap-2">
        <time class="block font-bold text-base-content" datetime="{{ .Date.Format "2006-01-02" }}">
          {{ .Date.Format "02 de Jan, 2006" }}
        </time>
        <span class="text-xs text-base-content/60">
          {{ .ReadingTime }} min de leitura
        </span>
      </div>
    </div>
  </header>

  {{ if ne $imageLink "" }}
  <div class="mx-auto max-w-6xl px-4 md:px-6 mb-16">
    <div class="w-full flex justify-center rounded-2xl overflow-hidden bg-base-200/30 border border-base-content/5 shadow-xl">
      <img 
        src="{{ $imageLink }}" 
        alt="{{ $.Title }}" 
        class="max-h-[85vh] w-auto h-auto object-contain"
      >
    </div>
  </div>
  {{ end }}

  <div class="mx-auto max-w-6xl px-6 grid grid-cols-1 lg:grid-cols-12 gap-12">
    
    <div class="lg:col-span-8 lg:col-start-2">
      <div class="prose prose-lg prose-neutral max-w-none text-base-content/80 prose-headings:text-base-content prose-headings:font-bold prose-headings:scroll-mt-24 prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-strong:text-base-content prose-code:before:!content-none prose-code:after:!content-none [&_:not(pre)>code]:text-primary [&_:not(pre)>code]:bg-base-200/50 [&_:not(pre)>code]:px-1.5 [&_:not(pre)>code]:py-0.5 [&_:not(pre)>code]:rounded-md [&_:not(pre)>code]:font-normal dark:[&_:not(pre)>code]:text-white dark:[&_:not(pre)>code]:bg-base-content/10 prose-pre:bg-[#282a36] prose-pre:text-gray-100 prose-pre:shadow-lg prose-pre:rounded-xl prose-img:rounded-xl prose-img:shadow-lg prose-img:border prose-img:border-base-content/5">
        {{ .Content }}
      </div>

      <div class="mt-16 pt-8 border-t border-base-content/10">
        <div class="flex flex-wrap gap-2 mb-12">
          {{ range .Params.tags }}
          <a href="/tags/{{ . | urlize }}" class="px-4 py-2 bg-base-200 text-base-content/70 rounded-lg text-sm font-medium hover:bg-primary hover:text-primary-content transition-all">#{{ . }}</a>
          {{ end }}
        </div>
        
        <nav class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {{ if .PrevInSection }}
            <a href="{{ .PrevInSection.RelPermalink }}" class="group flex flex-col p-4 rounded-xl border border-base-content/10 hover:border-primary/50 hover:bg-base-200/50 transition-all">
              <span class="text-xs text-base-content/50 uppercase font-bold mb-1">&laquo; Post Anterior</span>
              <span class="font-bold text-base-content group-hover:text-primary transition-colors line-clamp-1">{{ .PrevInSection.Title }}</span>
            </a>
            {{ else }} <div></div> {{ end }}
  
            {{ if .NextInSection }}
            <a href="{{ .NextInSection.RelPermalink }}" class="group flex flex-col items-end text-right p-4 rounded-xl border border-base-content/10 hover:border-primary/50 hover:bg-base-200/50 transition-all">
              <span class="text-xs text-base-content/50 uppercase font-bold mb-1">Próximo Post &raquo;</span>
              <span class="font-bold text-base-content group-hover:text-primary transition-colors line-clamp-1">{{ .NextInSection.Title }}</span>
            </a>
            {{ end }}
        </nav>
      </div>
    </div>
    
    <aside class="hidden lg:block lg:col-span-3">
       <div class="sticky top-24 pl-6 border-l border-base-content/10">
         <h3 class="text-sm font-bold uppercase tracking-wider text-base-content/40 mb-4">Nesta página</h3>
         <div class="toc text-sm text-base-content/70 space-y-2">{{ .TableOfContents }}</div>
         
         <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
                class="mt-8 flex items-center gap-2 text-xs font-bold text-primary hover:underline">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
          </svg>
          Voltar ao topo
        </button>
       </div>
    </aside>
  </div>

</article>

<style>
  .toc nav ul { list-style: none; padding: 0; margin: 0; }
  .toc nav ul li { margin-bottom: 0.5rem; }
  .toc nav ul ul { padding-left: 1rem; margin-top: 0.5rem; border-left: 1px solid var(--color-base-300); }
  .toc nav a { text-decoration: none; transition: color 0.2s; display: block; }
  .toc nav a:hover { color: var(--color-primary); }
</style>
{{ end }}